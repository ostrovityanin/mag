
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VK Debug Page</title>
    <style>
        body {
            font-family: monospace;
            background: #f0f0f0;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #ffe6e6;
        }
        .success {
            border-left-color: #28a745;
            background: #e6ffe6;
        }
    </style>
</head>
<body>
    <h1>üîç VK Mini App Debug Page</h1>
    <div id="debug-output"></div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug-info ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            document.getElementById('debug-output').appendChild(div);
            console.log(message);
        }

        log('üöÄ VK Debug Page –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        log(`üìç URL: ${window.location.href}`);
        log(`üåê User Agent: ${navigator.userAgent}`);
        log(`üìÑ Referrer: ${document.referrer}`);
        log(`üñºÔ∏è –í iframe: ${window !== window.top}`);

        // VK –ø—Ä–æ–≤–µ—Ä–∫–∏
        log('=== VK –ü–†–û–í–ï–†–ö–ò ===');
        log(`window.vkBridge: ${!!window.vkBridge ? '‚úÖ –ï–°–¢–¨' : '‚ùå –ù–ï–¢'}`);
        log(`window.VKWebAppInit: ${!!window.VKWebAppInit ? '‚úÖ –ï–°–¢–¨' : '‚ùå –ù–ï–¢'}`);

        // –í—Å–µ VK —Å–≤–æ–π—Å—Ç–≤–∞
        const vkProps = Object.keys(window).filter(key => key.toLowerCase().includes('vk'));
        log(`VK —Å–≤–æ–π—Å—Ç–≤–∞ –≤ window: ${vkProps.length > 0 ? vkProps.join(', ') : '–ù–ï–¢'}`);

        // User Agent –ø—Ä–æ–≤–µ—Ä–∫–∏
        const hasVKMA = /VKMA/.test(navigator.userAgent);
        const hasVKApp = /VKApp/.test(navigator.userAgent);
        log(`VKMA –≤ User Agent: ${hasVKMA ? '‚úÖ' : '‚ùå'}`);
        log(`VKApp –≤ User Agent: ${hasVKApp ? '‚úÖ' : '‚ùå'}`);

        // URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        const hasVKParams = window.location.href.includes('vk_');
        log(`VK –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL: ${hasVKParams ? '‚úÖ' : '‚ùå'}`);

        // PostMessage —Ç–µ—Å—Ç
        if (window.parent && window.parent !== window) {
            try {
                window.parent.postMessage({
                    type: 'vk_debug_test',
                    message: 'Test from debug page',
                    timestamp: Date.now()
                }, '*');
                log('üì§ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—é', 'success');
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ${e.message}`, 'error');
            }
        }

        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
        window.addEventListener('message', (event) => {
            log(`üì• –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: ${JSON.stringify({
                origin: event.origin,
                data: event.data
            })}`, 'success');
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞
        try {
            const parentHref = window.parent.location.href;
            log(`üåê Parent URL –¥–æ—Å—Ç—É–ø–µ–Ω: ${parentHref}`, 'success');
        } catch (e) {
            log(`üö´ Parent URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${e.message}`, 'error');
        }

        log('‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    </script>
</body>
</html>
